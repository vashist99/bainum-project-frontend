name: Frontend Security Scan

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]
  workflow_dispatch:  # Allow manual triggering when GitHub is stable
  schedule:
    # Run weekly security scans every Sunday at midnight UTC
    - cron: '0 0 * * 0'

jobs:
  security:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Run npm audit
      run: |
        echo "üîç Scanning frontend dependencies for vulnerabilities..."
        npm audit --audit-level=moderate || echo "‚ö†Ô∏è Some vulnerabilities found (non-blocking)"
      continue-on-error: true
    
    - name: Check for exposed secrets
      run: |
        echo "üîê Checking for common secret patterns..."
        # Basic check for common secret patterns
        if grep -r "password.*=.*['\"]" --include="*.js" --include="*.jsx" . 2>/dev/null | grep -v "//.*password" | grep -v "password.*//" | grep -v "node_modules"; then
          echo "‚ö†Ô∏è Potential hardcoded passwords found - please review"
        else
          echo "‚úÖ No obvious hardcoded passwords detected"
        fi
      continue-on-error: true
